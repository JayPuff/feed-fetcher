"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_createClass=function(){function o(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(e,t,r){return t&&o(e.prototype,t),r&&o(e,r),e}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}!function(t){var l=["json","text","blob"],f={json:"json",html:"text",txt:"text",md:"text",jpg:"blob",jpeg:"blob",png:"blob",ico:"blob",svg:"blob",mp3:"blob",mp4:"blob",webm:"blob",ogg:"blob"},e=new(function(){function e(){_classCallCheck(this,e),this._requirementsMet=!0,this._requirements={fetch:!0,promise:!0,requestAnimationFrame:!0},t.fetch&&t.Promise&&t.requestAnimationFrame||(console.warn("FeedFetcher - fetch/Promise/requestAnimationFrame are not defined on this browser - If you need to use a polyfill make sure it included before importing or including the FeedFetcher script"),this._requirementsMet=!1,t.fetch||(this._requirements.fetch=!1),t.Promise||(this._requirements.promise=!1),t.requestAnimationFrame||(this._requirements.requestAnimationFrame=!1),console.error("Requirements not met: [fetch: "+this._requirements.fetch+"] [Promise:"+this._requirements.promise+"] [requestAnimationFrame: "+this._requirements.requestAnimationFrame+"]")),this._nextIntervalID=1,this._feedObjects={},this._animationFrameID=null,this._timeoutPromise=function(r,o,n){return new Promise(function(e,t){setTimeout(function(){t(n)},o),r.then(e,t)})},this._fetchTimeout=function(e,t,r,o){return o=o||"Request timed out.",t=t||{},r=r||15e3,this._timeoutPromise(fetch(e,t),r,o)},this._step()}return _createClass(e,[{key:"_step",value:function(){for(var e in this._animationFrameID=requestAnimationFrame(this._step.bind(this)),this._feedObjects){var t=this._feedObjects[e],r=(new Date).getTime(),o=r-t._lastStep;t._lastStep=r,t._millisecondsSinceLastRefresh+=o,t._millisecondsSinceLastRefresh>=t._refreshRate&&(t._millisecondsSinceLastRefresh=0,this._doFetch(t))}}},{key:"_doFetch",value:function(r){if(r){if(r._once){if(r._fetchedOnce)return void this.clearInterval(r._feedID);r._fetchedOnce=!0}r._fetchID+=1;var o=!1,n=null,s=!1,i=null,a="",c="",u=!1;this._fetchTimeout(r._url,{cache:"no-store"},r._timeout).then(function(e){if(a=e.status||"",c=e.statusText||"",!e.ok)throw Error(e.status+" - "+e.statusText);return e}).then(function(e){return"json"==r._mode?(o=!0,n=e.clone(),e.json()):"blob"==r._mode?(s=!0,i=e.clone(),e.blob()):e.text()}).then(function(e){if("json"==r._mode){var t=JSON.stringify(e);r._cachedJson[r._url]==t&&r._onSameData?(u="onSameData",r._onSameData(e)):(u=!0,u="onData",r._onData(e,r._cachedJson[r._url]?JSON.parse(r._cachedJson[r._url]):null),r._cachedJson[r._url]=t)}else"blob"==r._mode?(u="onData",r._onData(e,null)):r._cachedText[r._url]==e&&r._onSameData?(u="onSameData",r._onSameData(e)):(u="onData",r._onData(e,r._cachedText[r._url]||null),r._cachedText[r._url]=e)}).catch(function(t){"Request timed out."==t?r._onError?r._onError({errorType:"FETCH_TIMEOUT",errorText:t,feedObject:r,status:a,statusText:c}):console.warn("FeedFetcher - Request timed out",{errorType:"FETCH_TIMEOUT",errorText:t,feedObject:r,status:a,statusText:c}):u?r._onError?r._onError({errorType:"USER_METHOD_ERROR",errorText:t,userMethod:u,feedObject:r,status:a,statusText:c}):console.warn("FeedFetcher - Caught an error within your code in callback function ["+u+"]",{errorType:"USER_METHOD_ERROR",userMethod:u,errorText:t,feedObject:r,status:a,statusText:c}):o?n.text().then(function(e){r._onError?r._onError({errorType:"JSON_PARSE_FAIL",errorText:t,feedObject:r,textContents:e}):console.warn("FeedFetcher - Text contents of failed json response:",{errorType:"JSON_PARSE_FAIL",errorText:t,feedObject:r,textContents:e})}).catch(function(e){r._onError?r._onError({errorType:"JSON_AND_TEXT_PARSE_FAIL",errorText:e,feedObject:r,rawResponse:n}):console.warn("FeedFetcher - Could not read text contents from failed json response:",{errorType:"JSON_AND_TEXT_PARSE_FAIL",errorText:e,feedObject:r,rawResponse:n})}):s?i.text().then(function(e){r._onError?r._onError({errorType:"BLOB_PARSE_FAIL",errorText:t,feedObject:r,textContents:e}):console.warn("FeedFetcher - Text contents of failed blob response:",{errorType:"BLOB_PARSE_FAIL",errorText:t,feedObject:r,textContents:e})}).catch(function(e){r._onError?r._onError({errorType:"BLOB_AND_TEXT_PARSE_FAIL",errorText:e,feedObject:r,rawResponse:n}):console.warn("FeedFetcher - Could not read text contents from failed blob response:",{errorType:"BLOB_AND_TEXT_PARSE_FAIL",errorText:e,feedObject:r,rawResponse:n})}):r._onError?r._onError({errorType:"FETCH_FAIL",errorText:t,feedObject:r,status:a,statusText:c}):console.warn("FeedFetcher - Response could not be fetched",{errorType:"FETCH_FAIL",errorText:t,feedObject:r,status:a,statusText:c})})}else console.error("FeedFetcher - Tried to fetch but not feed argument exists or it is null")}},{key:"fetch",value:function(e){this._setLogic(arguments,"fetch")}},{key:"setTimeout",value:function(e){return this._setLogic(arguments,"setTimeout")}},{key:"setInterval",value:function(e){return this._setLogic(arguments,"setInterval")}},{key:"_setLogic",value:function(e,t){if(this._requirementsMet){var r=null,o={},n=0;"object"==_typeof(e[n])?(o=e[n],"number"==typeof e[n+1]&&(r=e[n+1])):"string"==typeof e[n]&&(o.url=e[n],"string"==typeof e[n+=1]&&(o.mode=e[n],n+=1),"function"==typeof e[n]&&(o.onData=e[n],n+=1),"function"==typeof e[n]&&(o.onError=e[n],n+=1),"function"==typeof e[n]&&(o.onSameData=e[n],n+=1),"number"==typeof e[n]&&(r=e[n],n+=1)),"setTimeout"==t?(o.once=!0,o.setTimeout=!0):"fetch"==t&&(o.once=!0);var s=this._nextIntervalID;this._nextIntervalID+=1;var i={};if(i._lastStep=(new Date).getTime(),i._feedID=s,i._timeout=o.timeout,r?i._refreshRate=r:o.refreshRate?i._refreshRate=o.refreshRate:i._refreshRate=1e4,i._once=o.once,i._url=o.url||"http://no-url-specified.com/nothing",o.mode){i._mode=o.mode;var a=!1;for(var c in l)l[c]==i._mode&&(a=!0);if(!a)return void console.error("FeedFetcher - Mode ["+i._mode+"] given to feed fetcher through options is not supported.")}else{var u=i._url.split("."),_=u[u.length-1].toLowerCase();i._mode=f[_]||"text"}return o.setTimeout?i._millisecondsSinceLastRefresh=0:i._millisecondsSinceLastRefresh=i._refreshRate,i._fetchID=0,i._cachedJson={},i._cachedText={},i._onData=o.onData||function(e){console.info("FeedFetcher - Received data but no onData method was passed through constructor",{data:e})},i._onSameData=o.onSameData||null,i._onError=o.onError||null,this._feedObjects[s]=i,s}console.error("Requirements not met for setFeedInterval: [fetch: "+this._requirements.fetch+"] [Promise:"+this._requirements.promise+"] [requestAnimationFrame: "+this._requirements.requestAnimationFrame+"]")}},{key:"clearInterval",value:function(e){this._feedObjects[e]&&delete this._feedObjects[e]}},{key:"clearTimeout",value:function(e){clearInterval(e)}}]),e}());t&&(t.feedFetcher=e),"undefined"!=typeof module&&module.exports&&(module.exports=e)}(window);