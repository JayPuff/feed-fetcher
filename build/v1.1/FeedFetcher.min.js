"use strict";var _createClass=function(){function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}!function(){var a=["json","text"],t=new(function(){function e(){_classCallCheck(this,e),this._requirementsMet=!0,this._requirements={fetch:!0,promise:!0,requestAnimationFrame:!0},window.fetch&&window.Promise&&window.requestAnimationFrame||(console.warn("FeedFetcher - fetch/Promise/requestAnimationFrame are not defined on this browser - If you need to use a polyfill make sure it included before importing or including the FeedFetcher script"),this._requirementsMet=!1,window.fetch||(this._requirements.fetch=!1),window.Promise||(this._requirements.promise=!1),window.requestAnimationFrame||(this._requirements.requestAnimationFrame=!1),console.error("Requirements not met: [fetch: "+this._requirements.fetch+"] [Promise:"+this._requirements.promise+"] [requestAnimationFrame: "+this._requirements.requestAnimationFrame+"]")),this._nextIntervalID=1,this._feedObjects={},this._animationFrameID=null,this._timeoutPromise=function(r,n,o){return new Promise(function(e,t){setTimeout(function(){t(o)},n),r.then(e,t)})},this._fetchTimeout=function(e,t,r,n){return n=n||"Request timed out.",t=t||{},r=r||1e4,this._timeoutPromise(fetch(e,t),r,n)},this._step()}return _createClass(e,[{key:"_step",value:function(){for(var e in this._animationFrameID=requestAnimationFrame(this._step.bind(this)),this._feedObjects){var t=this._feedObjects[e],r=(new Date).getTime(),n=r-t._lastStep;t._lastStep=r,t._millisecondsSinceLastRefresh+=n,t._millisecondsSinceLastRefresh>=t._refreshRate&&(t._millisecondsSinceLastRefresh=0,this._doFetch(t))}}},{key:"_doFetch",value:function(r){if(r){r._fetchID+=1;var n=!1,o=null,s="",i="";this._fetchTimeout(r._url,{cache:"no-store"},5e3).then(function(e){if(s=e.status||"",i=e.statusText||"",!e.ok)throw Error(e.status+" - "+e.statusText);return e}).then(function(e){return"json"==r._mode?(n=!0,o=e.clone(),e.json()):e.text()}).then(function(e){if("json"==r._mode){var t=JSON.stringify(e);r._cachedJson[r._url]==t&&r._compareWithCache?r._onSameData(e):(r._onData(e,r._cachedJson[r._url]?JSON.parse(r._cachedJson[r._url]):null),r._cachedJson[r._url]=t)}else r._cachedText[r._url]==e&&r._compareWithCache?r._onSameData(e):(r._onData(e,r._cachedText[r._url]||null),r._cachedText[r._url]=e)}).catch(function(t){"Request timed out."==t?r._onError?r._onError({errorType:"FETCH_TIMEOUT",errorText:t,feedObject:r,status:s,statusText:i}):console.warn("FeedFetcher - Request timed out",{errorType:"FETCH_TIMEOUT",errorText:t,feedObject:r,status:s,statusText:i}):n?o.text().then(function(e){r._onError?r._onError({errorType:"JSON_PARSE_FAIL",errorText:t,feedObject:r,textContents:e}):console.warn("FeedFetcher - Text contents of failed json response:",{errorType:"JSON_PARSE_FAIL",errorText:t,feedObject:r,textContents:e})}).catch(function(e){r._onError?r._onError({errorType:"JSON_AND_TEXT_PARSE_FAIL",errorText:e,feedObject:r,rawResponse:o}):console.warn("FeedFetcher - Could not read text contents from failed json response:",{errorType:"JSON_AND_TEXT_PARSE_FAIL",errorText:e,feedObject:r,rawResponse:o})}):r._onError?r._onError({errorType:"FETCH_FAIL",errorText:t,feedObject:r,status:s,statusText:i}):console.warn("FeedFetcher - Response could not be fetched",{errorType:"FETCH_FAIL",errorText:t,feedObject:r,status:s,statusText:i})})}else console.error("FeedFetcher - Tried to fetch but not feed argument exists or it is null")}},{key:"setFeedInterval",value:function(e){if(this._requirementsMet){var t=this._nextIntervalID;this._nextIntervalID+=1;var r={};if(r._lastStep=(new Date).getTime(),r._feedID=t,e||(e={}),e.refreshRate?r._refreshRate=1e3*e.refreshRate:r._refreshRate=1e4,r._url=e.url||"http://no-url-specified.com/nothing",e.mode){r._mode=e.mode;var n=!1;for(var o in a)a[o]==r._mode&&(n=!0);if(!n)return void console.error("FeedFetcher - Mode ["+r._mode+"] given to feed fetcher through options is not supported.")}else{var s=r._url.split("."),i=s[s.length-1].toLowerCase();r._mode="json"==i?"json":"text"}return r._millisecondsSinceLastRefresh=r._refreshRate,r._fetchID=0,r._cachedJson={},r._cachedText={},r._compareWithCache=e.compareWithCache||!1,r._onData=e.onData||function(e){console.info("FeedFetcher - Received data but no onData method was passed through constructor",{data:e})},r._onSameData=e.onSameData||function(){},r._onError=e.onError||null,this._feedObjects[t]=r,t}console.error("Requirements not met for setFeedInterval: [fetch: "+this._requirements.fetch+"] [Promise:"+this._requirements.promise+"] [requestAnimationFrame: "+this._requirements.requestAnimationFrame+"]")}},{key:"clearFeedInterval",value:function(e){this._feedObjects[e]&&(delete this._feedObjects[e],console.log("FeedFetcher - cleared feed #"+e))}},{key:"setFeedGroupInterval",value:function(e){console.warn("FeedFetcher - setFeedGroupInterval is not implemented yet.")}}]),e}());window.setFeedInterval=function(e){return t.setFeedInterval(e)},window.clearFeedInterval=function(e){t.clearFeedInterval(e)}}();